% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/classify_reads.R
\name{classify_reads}
\alias{classify_reads}
\title{Classify Reads as Case or Control Based on Methylation Profiles}
\usage{
classify_reads(ch3_db, key_table, case, control, meth_diff_threshold = 0.1)
}
\arguments{
\item{ch3_db}{Path to a DuckDB `.db` file created by this package (e.g., from `summarize_reads()`).}

\item{key_table}{Path to a CSV, TSV, or BED file generated by `collapse_windows()`. Must include the columns:
`chrom`, `start`, `end`, `avg_mh_frac_control`, `avg_mh_frac_case`, and `avg_meth_diff`.}

\item{case}{Character string used to label case reads (e.g., `"case"`).}

\item{control}{Character string used to label control reads (e.g., `"control"`).}

\item{meth_diff_threshold}{Numeric value specifying the maximum difference in `mh_frac` allowed
to match either case or control averages. Must be less than half the minimum absolute value of
`avg_meth_diff` to prevent ambiguous classifications.}
}
\value{
Invisibly returns the open database connection with a new table named `classified_reads`
added to the database. This table includes:
\itemize{
  \item \code{sample_name} – Sample identifier
  \item \code{read_id} – Unique read identifier
  \item \code{first_cpg_pos} – First CpG position of the read
  \item \code{last_cpg_pos} – Last CpG position of the read
  \item \code{mh_frac} – Methylation fraction of the read
  \item \code{classification} – `"case"`, `"control"`, or `"unknown"`
}
}
\description{
This function classifies reads in the `reads` table of a DuckDB database
as either `"case"`, `"control"`, or `"unknown"` based on similarity
to reference methylation fractions in a `key_table` (e.g., a collapsed windows file).
Classification is based on how close the read's `mh_frac` is to the average
case or control `mh_frac`, within a user-defined `meth_diff_threshold`.
}
\details{
This function runs entirely in SQL for scalability. It performs an interval join
between the `reads` table and the key table on `chrom` and CpG position range,
then classifies each read based on proximity of `mh_frac` to either `avg_mh_frac_control` or `avg_mh_frac_case`.
}
\examples{
\dontrun{
classify_reads(
  ch3_db = "my_data.ch3.db",
  key_table = "key_table.csv",
  case = "treated",
  control = "untreated",
  meth_diff_threshold = 0.1
)
}

}
